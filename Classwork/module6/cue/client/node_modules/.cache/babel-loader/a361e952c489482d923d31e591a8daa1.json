{"ast":null,"code":"import { useContext } from 'react';\nimport axios from 'axios';\nconst spotifyUserAPI = axios.create(); // declare localStorage keys\n\nexport const LOCALSTORAGE_KEYS = {\n  accessToken: 'spotify_access_token',\n  expireTime: 'spotify_token_expire_time',\n  timestamp: 'spotify_token_timestamp'\n}; // retrieve localStorage values\n\nexport const LOCALSTORAGE_VALUES = {\n  accessToken: localStorage.getItem(LOCALSTORAGE_KEYS.accessToken),\n  expireTime: localStorage.getItem(LOCALSTORAGE_KEYS.expireTime),\n  timestamp: localStorage.getItem(LOCALSTORAGE_KEYS.timestamp)\n};\n/**\n * Clear out all localStorage items we've set and reload the page\n */\n\nexport const spotifyLogout = () => {\n  localStorage.removeItem('spotify_access_token');\n  localStorage.removeItem('spotify_token_expire_time');\n  localStorage.removeItem('spotify_token_timestamp');\n};\n/**\n * Checks if the amount of time that has elapsed between the timestamp in localStorage\n * and now is greater than the expiration time of 3600 seconds (1 hour).\n */\n\nconst hasTokenExpired = () => {\n  const {\n    accessToken,\n    timestamp,\n    expireTime\n  } = LOCALSTORAGE_VALUES;\n\n  if (!accessToken || !timestamp) {\n    return false;\n  }\n\n  const millisecondsElapsed = Date.now() - Number(timestamp);\n  return millisecondsElapsed / 1000 > Number(expireTime);\n};\n\nconst getAccessToken = () => {\n  const queryString = window.location.search;\n  const urlParams = new URLSearchParams(queryString);\n  const queryParams = {\n    [LOCALSTORAGE_KEYS.accessToken]: urlParams.get('access_token') // [LOCALSTORAGE_KEYS.refreshToken]: urlParams.get('refresh_token'),\n    // [LOCALSTORAGE_KEYS.expireTime]: urlParams.get('expires_in'),\n\n  }; // If there is a token in the URL query params, user is logging in for the first time\n\n  if (queryParams[LOCALSTORAGE_KEYS.accessToken]) {\n    // Store the query params in localStorage\n    for (const property in queryParams) {\n      window.localStorage.setItem(property, queryParams[property]);\n    } // Set timestamp to keys\n\n\n    window.localStorage.setItem(LOCALSTORAGE_KEYS.timestamp, Date.now()); // Return access token from query params\n\n    return queryParams[LOCALSTORAGE_KEYS.accessToken];\n  }\n\n  return false;\n};\n\nexport const accessToken = getAccessToken(); // set global configs for this instance\n\nspotifyUserAPI.interceptors.request.use(config => {\n  config.headers.Authorization = `Bearer ${accessToken}`;\n  config.baseURL = 'https://api.spotify.com/v1';\n  return config;\n});\nexport const getCurrentUserProfile = () => spotifyUserAPI.get('/me');","map":{"version":3,"sources":["/Users/quinntoncarter/Documents/VSchool/Classwork/module6/cue/client/src/components/spotify.js"],"names":["useContext","axios","spotifyUserAPI","create","LOCALSTORAGE_KEYS","accessToken","expireTime","timestamp","LOCALSTORAGE_VALUES","localStorage","getItem","spotifyLogout","removeItem","hasTokenExpired","millisecondsElapsed","Date","now","Number","getAccessToken","queryString","window","location","search","urlParams","URLSearchParams","queryParams","get","property","setItem","interceptors","request","use","config","headers","Authorization","baseURL","getCurrentUserProfile"],"mappings":"AAAA,SAASA,UAAT,QAA2B,OAA3B;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,MAAMC,cAAc,GAAGD,KAAK,CAACE,MAAN,EAAvB,C,CAEA;;AACA,OAAO,MAAMC,iBAAiB,GAAG;AAC7BC,EAAAA,WAAW,EAAE,sBADgB;AAE7BC,EAAAA,UAAU,EAAE,2BAFiB;AAG7BC,EAAAA,SAAS,EAAE;AAHkB,CAA1B,C,CAMP;;AACA,OAAO,MAAMC,mBAAmB,GAAG;AAC/BH,EAAAA,WAAW,EAAEI,YAAY,CAACC,OAAb,CAAqBN,iBAAiB,CAACC,WAAvC,CADkB;AAE/BC,EAAAA,UAAU,EAAEG,YAAY,CAACC,OAAb,CAAqBN,iBAAiB,CAACE,UAAvC,CAFmB;AAG/BC,EAAAA,SAAS,EAAEE,YAAY,CAACC,OAAb,CAAqBN,iBAAiB,CAACG,SAAvC;AAHoB,CAA5B;AAMP;AACA;AACA;;AACA,OAAO,MAAMI,aAAa,GAAG,MAAM;AACjCF,EAAAA,YAAY,CAACG,UAAb,CAAwB,sBAAxB;AACAH,EAAAA,YAAY,CAACG,UAAb,CAAwB,2BAAxB;AACAH,EAAAA,YAAY,CAACG,UAAb,CAAwB,yBAAxB;AAED,CALM;AAOP;AACA;AACA;AACA;;AACA,MAAMC,eAAe,GAAG,MAAM;AAC1B,QAAM;AAAER,IAAAA,WAAF;AAAeE,IAAAA,SAAf;AAA0BD,IAAAA;AAA1B,MAAyCE,mBAA/C;;AACA,MAAI,CAACH,WAAD,IAAgB,CAACE,SAArB,EAAgC;AAC5B,WAAO,KAAP;AACH;;AACD,QAAMO,mBAAmB,GAAGC,IAAI,CAACC,GAAL,KAAaC,MAAM,CAACV,SAAD,CAA/C;AACA,SAAQO,mBAAmB,GAAG,IAAvB,GAA+BG,MAAM,CAACX,UAAD,CAA5C;AACH,CAPD;;AAUA,MAAMY,cAAc,GAAG,MAAM;AACzB,QAAMC,WAAW,GAAGC,MAAM,CAACC,QAAP,CAAgBC,MAApC;AACA,QAAMC,SAAS,GAAG,IAAIC,eAAJ,CAAoBL,WAApB,CAAlB;AACA,QAAMM,WAAW,GAAG;AAChB,KAACrB,iBAAiB,CAACC,WAAnB,GAAiCkB,SAAS,CAACG,GAAV,CAAc,cAAd,CADjB,CAEhB;AACA;;AAHgB,GAApB,CAHyB,CASzB;;AACA,MAAID,WAAW,CAACrB,iBAAiB,CAACC,WAAnB,CAAf,EAAgD;AAC9C;AACE,SAAK,MAAMsB,QAAX,IAAuBF,WAAvB,EAAoC;AACpCL,MAAAA,MAAM,CAACX,YAAP,CAAoBmB,OAApB,CAA4BD,QAA5B,EAAsCF,WAAW,CAACE,QAAD,CAAjD;AACC,KAJ2C,CAK9C;;;AACEP,IAAAA,MAAM,CAACX,YAAP,CAAoBmB,OAApB,CAA4BxB,iBAAiB,CAACG,SAA9C,EAAyDQ,IAAI,CAACC,GAAL,EAAzD,EAN4C,CAO9C;;AACE,WAAOS,WAAW,CAACrB,iBAAiB,CAACC,WAAnB,CAAlB;AACH;;AACD,SAAO,KAAP;AACH,CArBD;;AAuBA,OAAO,MAAMA,WAAW,GAAGa,cAAc,EAAlC,C,CAEP;;AACAhB,cAAc,CAAC2B,YAAf,CAA4BC,OAA5B,CAAoCC,GAApC,CAAwCC,MAAM,IAAI;AAC9CA,EAAAA,MAAM,CAACC,OAAP,CAAeC,aAAf,GAAgC,UAAS7B,WAAY,EAArD;AACA2B,EAAAA,MAAM,CAACG,OAAP,GAAiB,4BAAjB;AACA,SAAOH,MAAP;AACH,CAJD;AAMA,OAAO,MAAMI,qBAAqB,GAAG,MAAMlC,cAAc,CAACwB,GAAf,CAAmB,KAAnB,CAApC","sourcesContent":["import { useContext } from 'react';\nimport axios from 'axios';\nconst spotifyUserAPI = axios.create();\n\n// declare localStorage keys\nexport const LOCALSTORAGE_KEYS = {\n    accessToken: 'spotify_access_token',\n    expireTime: 'spotify_token_expire_time',\n    timestamp: 'spotify_token_timestamp',\n}\n\n// retrieve localStorage values\nexport const LOCALSTORAGE_VALUES = {\n    accessToken: localStorage.getItem(LOCALSTORAGE_KEYS.accessToken),\n    expireTime: localStorage.getItem(LOCALSTORAGE_KEYS.expireTime),\n    timestamp: localStorage.getItem(LOCALSTORAGE_KEYS.timestamp),\n};\n\n/**\n * Clear out all localStorage items we've set and reload the page\n */\nexport const spotifyLogout = () => {\n  localStorage.removeItem('spotify_access_token')\n  localStorage.removeItem('spotify_token_expire_time')\n  localStorage.removeItem('spotify_token_timestamp')\n\n};\n\n/**\n * Checks if the amount of time that has elapsed between the timestamp in localStorage\n * and now is greater than the expiration time of 3600 seconds (1 hour).\n */\nconst hasTokenExpired = () => {\n    const { accessToken, timestamp, expireTime } = LOCALSTORAGE_VALUES;\n    if (!accessToken || !timestamp) {\n        return false;\n    }\n    const millisecondsElapsed = Date.now() - Number(timestamp);\n    return (millisecondsElapsed / 1000) > Number(expireTime);\n};\n\n\nconst getAccessToken = () => {\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    const queryParams = {\n        [LOCALSTORAGE_KEYS.accessToken]: urlParams.get('access_token'),\n        // [LOCALSTORAGE_KEYS.refreshToken]: urlParams.get('refresh_token'),\n        // [LOCALSTORAGE_KEYS.expireTime]: urlParams.get('expires_in'),\n    };\n\n    // If there is a token in the URL query params, user is logging in for the first time\n    if (queryParams[LOCALSTORAGE_KEYS.accessToken]) {\n      // Store the query params in localStorage\n        for (const property in queryParams) {\n        window.localStorage.setItem(property, queryParams[property]);\n        }\n      // Set timestamp to keys\n        window.localStorage.setItem(LOCALSTORAGE_KEYS.timestamp, Date.now());\n      // Return access token from query params\n        return queryParams[LOCALSTORAGE_KEYS.accessToken];\n    }\n    return false;\n}\n\nexport const accessToken = getAccessToken();\n\n// set global configs for this instance\nspotifyUserAPI.interceptors.request.use(config => {\n    config.headers.Authorization = `Bearer ${accessToken}`\n    config.baseURL = 'https://api.spotify.com/v1'\n    return config\n});\n\nexport const getCurrentUserProfile = () => spotifyUserAPI.get('/me');"]},"metadata":{},"sourceType":"module"}